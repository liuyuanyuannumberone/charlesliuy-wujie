# 无界方案

iframe + webComponent

## 实现原理

1. 通信问题

- props通信: 主应用可以通过props注入数据和方法;
- window通信: 由于在设计上子应用运行的iframe的src和主应用是同源的,所以相互可以直接通信;
- eventBus通信: 提供了一套去中心化的通讯方式;

3. dom割裂的问题

在iframe中拦截document对象,统一将dom指向shadowRoot,此时比如新建元素、弹窗或者冒泡组件就可以正常约束在shadowRoot内部;

4. 白屏的问题

首次白屏的问题,wujie实例可以提前实例化,包括shadowRoot、iframe的创建、js的执行,这样极大的加快子应用第一次打开的时间;
切换白屏的问题，一旦wujie实例可以缓存下来，子应用的切换成本变的极低，如果采用保活模式，那么相当于shadowRoot的插拔;

5. 路由管理

- 路由同步
  会将子应用路径的path+query+hash通过window.encodeURIComponent编码后挂载在主应用url的查询参数上,其中key值为子应用的name;
  开启路由同步后，刷新浏览器或者将url分享出去子应用的路由状态都不会丢失，当一个页面存在多个子应用时无界支持所有子应用路由同步，浏览器刷新、前进、后退子应用路由状态也都不会丢失，并且提供短路径的能力，当子应用的url过长时，可以通过配置 prefix来缩短子应用同步到主应用的路径，无界在选取短路径的时候，按照匹配最长路径原则选取短路径。

- 路由跳转

  无界支持子应用间的路由的跳转,例如子应用a可以跳转子应用b，也可以从子应用a跳转到子应用b的指定路由中;